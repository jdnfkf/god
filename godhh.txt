loadstring([[
-- æ‰‹æœºç«¯é€šç”¨ç”Ÿå­˜è„šæœ¬ V5.0ï¼ˆå®Œå…¨ä¿®å¤ç‰ˆï¼‰
-- ä½œè€…ï¼šé€šç”¨è„šæœ¬é€‚é…
-- æ ¼å¼ï¼šLua 5.1
-- åŠŸèƒ½ï¼š9å€å›žè¡€ + æ— é™é‡ç”Ÿ + å…¨é˜²æŠ¤ç³»ç»Ÿ

-- ==================== å…¨å±€æœåŠ¡åˆå§‹åŒ– ====================
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Lighting = game:GetService("Lighting")
local UserInputService = game:GetService("UserInputService")
local ScriptContext = game:GetService("ScriptContext")
local Debris = game:GetService("Debris")

-- èŽ·å–æœ¬åœ°çŽ©å®¶
local LocalPlayer = Players.LocalPlayer
while not LocalPlayer do
    wait(0.1)
    LocalPlayer = Players.LocalPlayer
end

-- ==================== æ ¸å¿ƒé…ç½® ====================
local CONFIG = {
    -- å›žè¡€ç³»ç»Ÿ
    HEAL_MULTIPLIER = 9, -- 9å€å›žè¡€
    HEAL_BASE_RATE = 0.015, -- åŸºç¡€å›žè¡€çŽ‡
    EMERGENCY_HEAL = 0.4, -- ç´§æ€¥å›žè¡€é˜ˆå€¼
    EMERGENCY_BOOST = 2.5, -- ç´§æ€¥å›žè¡€å€çŽ‡
    
    -- é‡ç”Ÿç³»ç»Ÿ
    RESPAWN_DELAY = 0.01, -- é‡ç”Ÿå»¶è¿Ÿ
    RESPAWN_OFFSET = Vector3.new(0, 3.5, 0), -- é‡ç”Ÿé«˜åº¦åç§»
    RESPAWN_MEMORY = 20, -- è®°å¿†ä½ç½®æ•°é‡
    
    -- æŠ“å–æ‹¦æˆª
    ANTI_GRAB_RANGE = 35,
    GRAB_FORCE_LIMIT = 8500,
    PUSH_FORCE = 28,
    
    -- çªè„¸æ‹¦æˆª
    WARP_THRESHOLD = 18,
    WARP_SPEED_LIMIT = 150,
    
    -- å…³é”®è¯åˆ—è¡¨
    DEATH_KEYWORDS = {
        "Kill", "Death", "Die", "Dead", "Execute", "Murder", "Slay",
        "ScriptedDeath", "StoryKill", "OneShot", "InstaKill", "AdminKill",
        "ForceKill", "RemoteKill", "SystemKill", "GameKill"
    },
    
    SPECTATOR_KEYWORDS = {
        "Spectator", "Spectate", "Observer", "Ghost", "DeathCam",
        "è§‚æˆ˜", "æ—è§‚", "è§‚å¯Ÿ", "å¹½çµ"
    }
}

-- ==================== å…¨å±€çŠ¶æ€ ====================
local STATE = {
    Character = nil,
    Humanoid = nil,
    RootPart = nil,
    
    IsValid = false,
    IsRespawning = false,
    IsDead = false,
    
    DeathPositions = {},
    LastSafePos = nil,
    LastValidCF = nil,
    LastHealth = 100,
    
    Connections = {},
    BlockedRemotes = {},
    BlockedScripts = {}
}

-- ==================== å·¥å…·å‡½æ•° ====================
local Tools = {}

-- å®‰å…¨æ‰§è¡Œ
function Tools.Safe(func, ...)
    local success, result = pcall(func, ...)
    if not success then
        return nil
    end
    return result
end

-- å»¶è¿Ÿæ‰§è¡Œ
function Tools.Delay(delay, func, ...)
    local args = {...}
    spawn(function()
        if delay > 0 then wait(delay) end
        Tools.Safe(func, unpack(args))
    end)
end

-- èŽ·å–å®žä¾‹
function Tools.GetChild(parent, name, class)
    if not parent then return nil end
    local child = parent:FindFirstChild(name)
    if child and (not class or child:IsA(class)) then
        return child
    end
    return nil
end

-- å­—ç¬¦ä¸²åŒ¹é…
function Tools.Match(str, list)
    if type(str) ~= "string" then return false end
    str = str:lower()
    for _, pattern in pairs(list) do
        if str:find(pattern:lower(), 1, true) then
            return true
        end
    end
    return false
end

-- è®°å½•ä½ç½®
function Tools.RecordPos(pos)
    if not pos then return end
    table.insert(STATE.DeathPositions, {
        Position = pos,
        Time = tick()
    })
    while #STATE.DeathPositions > CONFIG.RESPAWN_MEMORY do
        table.remove(STATE.DeathPositions, 1)
    end
    STATE.LastSafePos = pos
end

-- èŽ·å–æœ€è¿‘ä½ç½®
function Tools.GetRecentPos()
    if #STATE.DeathPositions > 0 then
        return STATE.DeathPositions[#STATE.DeathPositions].Position
    end
    return STATE.LastSafePos or Vector3.new(0, 10, 0)
end

-- æ–­å¼€è¿žæŽ¥
function Tools.Disconnect(conn)
    if conn and typeof(conn) == "RBXScriptConnection" then
        Tools.Safe(function()
            if conn.Connected then
                conn:Disconnect()
            end
        end)
    end
end

-- æ–­å¼€æ‰€æœ‰è¿žæŽ¥
function Tools.DisconnectAll()
    for _, conn in pairs(STATE.Connections) do
        Tools.Disconnect(conn)
    end
    STATE.Connections = {}
end

-- å¼ºåˆ¶å­˜æ´»
function Tools.ForceAlive(humanoid)
    if not humanoid then return false end
    return Tools.Safe(function()
        if humanoid.Health <= 0 then
            humanoid.Health = math.max(1, humanoid.MaxHealth * 0.8)
        end
        humanoid:SetAttribute("Dead", false)
        return true
    end) or false
end

-- ==================== æ¨¡å—1ï¼š9å€è‡ªåŠ¨å›žè¡€ ====================
local HealModule = {}

function HealModule.Start(humanoid)
    if not humanoid then return end
    
    local healRate = humanoid.MaxHealth * CONFIG.HEAL_BASE_RATE * CONFIG.HEAL_MULTIPLIER
    
    local conn = RunService.Heartbeat:Connect(function(dt)
        if not humanoid or not humanoid.Parent then
            Tools.Disconnect(conn)
            return
        end
        
        if not STATE.IsValid or humanoid.Health <= 0 then
            return
        end
        
        Tools.Safe(function()
            -- è®¡ç®—å›žè¡€é‡
            local heal = healRate * dt
            
            -- ç´§æ€¥å›žè¡€
            if humanoid.Health / humanoid.MaxHealth < CONFIG.EMERGENCY_HEAL then
                heal = heal * CONFIG.EMERGENCY_BOOST
            end
            
            -- åº”ç”¨å›žè¡€
            local newHealth = humanoid.Health + heal
            newHealth = math.min(newHealth, humanoid.MaxHealth)
            
            if newHealth < 1 then
                newHealth = math.max(1, humanoid.MaxHealth * 0.3)
            end
            
            humanoid.Health = newHealth
            STATE.LastHealth = humanoid.Health
        end)
    end)
    
    table.insert(STATE.Connections, conn)
    
    -- è¡€é‡ç›‘æŽ§
    local monitor = humanoid:GetPropertyChangedSignal("Health"):Connect(function()
        Tools.Safe(function()
            if humanoid.Health <= 0 and STATE.IsValid then
                humanoid.Health = math.max(1, humanoid.MaxHealth * 0.5)
            end
        end)
    end)
    
    table.insert(STATE.Connections, monitor)
    
    -- æ‰‹æœºè§¦æ‘¸å›žè¡€
    if UserInputService.TouchEnabled then
        local touch = UserInputService.TouchTap:Connect(function(_, processed)
            if not processed and humanoid and STATE.IsValid then
                Tools.Safe(function()
                    if humanoid.Health < humanoid.MaxHealth * 0.6 then
                        humanoid.Health = humanoid.Health + humanoid.MaxHealth * 0.25
                    end
                end)
            end
        end)
        table.insert(STATE.Connections, touch)
    end
end

-- ==================== æ¨¡å—2ï¼šæŠ“å–æ‹¦æˆª ====================
local GrabModule = {}

function GrabModule.Start(character)
    if not character then return end
    
    local root = Tools.GetChild(character, "HumanoidRootPart", "BasePart")
    if not root then return end
    
    -- æ‹¦æˆªå…³èŠ‚
    local jointConn = character.DescendantAdded:Connect(function(desc)
        if not STATE.IsValid then return end
        
        Tools.Safe(function()
            if desc:IsA("WeldConstraint") or desc:IsA("Weld") then
                local part0 = desc.Part0
                local part1 = desc.Part1
                
                if part0 and not part0:IsDescendantOf(character) then
                    desc:Destroy()
                elseif part1 and not part1:IsDescendantOf(character) then
                    desc:Destroy()
                end
            end
        end)
    end)
    
    table.insert(STATE.Connections, jointConn)
    
    -- çˆ¶å¯¹è±¡ç›‘æŽ§
    local parentConn = root:GetPropertyChangedSignal("Parent"):Connect(function()
        if not STATE.IsValid then return end
        
        Tools.Safe(function()
            local parent = root.Parent
            if parent and parent ~= character then
                if not parent:IsDescendantOf(Workspace) then
                    root.Parent = character
                end
            end
        end)
    end)
    
    table.insert(STATE.Connections, parentConn)
    
    -- åŠ›åœºæ£€æµ‹
    local forceConn = RunService.Heartbeat:Connect(function()
        if not STATE.IsValid or not root then return end
        
        Tools.Safe(function()
            -- æ£€æµ‹é™„è¿‘åŠ›åœº
            local region = Region3.new(
                root.Position - Vector3.new(CONFIG.ANTI_GRAB_RANGE, CONFIG.ANTI_GRAB_RANGE, CONFIG.ANTI_GRAB_RANGE),
                root.Position + Vector3.new(CONFIG.ANTI_GRAB_RANGE, CONFIG.ANTI_GRAB_RANGE, CONFIG.ANTI_GRAB_RANGE)
            )
            
            local parts = Workspace:FindPartsInRegion3(region, character, 100)
            
            for _, part in pairs(parts) do
                if part.Parent ~= character then
                    -- æ£€æµ‹æŠ“å–åŠ›
                    local force = part:FindFirstChildOfClass("BodyForce")
                    local velocity = part:FindFirstChildOfClass("BodyVelocity")
                    local position = part:FindFirstChildOfClass("BodyPosition")
                    
                    if force and force.Force.Magnitude > CONFIG.GRAB_FORCE_LIMIT then
                        force:Destroy()
                        if part.Parent:FindFirstChildOfClass("Humanoid") then
                            local dir = (root.Position - part.Position).Unit
                            part.Velocity = dir * CONFIG.PUSH_FORCE
                        end
                    end
                    
                    if velocity and velocity.Velocity.Magnitude > CONFIG.GRAB_FORCE_LIMIT then
                        velocity:Destroy()
                    end
                    
                    if position then
                        position:Destroy()
                    end
                end
            end
        end)
    end)
    
    table.insert(STATE.Connections, forceConn)
end

-- ==================== æ¨¡å—3ï¼šçªè„¸æ‹¦æˆª ====================
local WarpModule = {}

function WarpModule.Start(character)
    if not character then return end
    
    local root = Tools.GetChild(character, "HumanoidRootPart", "BasePart")
    if not root then return end
    
    local lastPos = root.Position
    local lastTime = tick()
    local lock = false
    
    local warpConn = RunService.Heartbeat:Connect(function()
        if not STATE.IsValid or not root or lock then return end
        
        Tools.Safe(function()
            local now = tick()
            local dt = now - lastTime
            
            -- è®¡ç®—ä½ç§»
            local currentPos = root.Position
            local delta = (currentPos - lastPos).Magnitude
            local speed = delta / math.max(dt, 0.001)
            
            -- æ£€æµ‹çªè„¸
            if speed > CONFIG.WARP_SPEED_LIMIT or 
               (delta > CONFIG.WARP_THRESHOLD and dt < 0.05) then
                
                lock = true
                
                -- è¿˜åŽŸä½ç½®
                root.CFrame = CFrame.new(lastPos) + CONFIG.RESPAWN_OFFSET
                
                -- é‡ç½®ç‰©ç†
                root.Velocity = Vector3.new(0, 0, 0)
                root.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
                
                -- è§£é”
                wait(0.05)
                lock = false
            else
                -- æ›´æ–°ä½ç½®
                lastPos = currentPos
            end
            
            lastTime = now
            STATE.LastValidCF = root.CFrame
        end)
    end)
    
    table.insert(STATE.Connections, warpConn)
end

-- ==================== æ¨¡å—4ï¼šå‰§æƒ…æ€æ‹¦æˆª ====================
local ScriptDeathModule = {}

function ScriptDeathModule.Start(humanoid)
    if not humanoid then return end
    
    -- è¡€é‡ä¿æŠ¤
    local healthConn = humanoid:GetPropertyChangedSignal("Health"):Connect(function()
        if not STATE.IsValid then return end
        
        Tools.Safe(function()
            if humanoid.Health <= 0 then
                humanoid.Health = math.max(1, humanoid.MaxHealth * 0.7)
            elseif humanoid.Health < humanoid.MaxHealth * 0.15 then
                humanoid.Health = humanoid.MaxHealth * 0.4
            end
        end)
    end)
    
    table.insert(STATE.Connections, healthConn)
    
    -- æœ€å¤§è¡€é‡ä¿æŠ¤
    local maxConn = humanoid:GetPropertyChangedSignal("MaxHealth"):Connect(function()
        Tools.Safe(function()
            if humanoid.MaxHealth < 50 then
                humanoid.MaxHealth = 100
            end
        end)
    end)
    
    table.insert(STATE.Connections, maxConn)
    
    -- æ­»äº¡äº‹ä»¶æ‹¦æˆª
    local diedConn = humanoid.Died:Connect(function()
        if STATE.IsValid then
            Tools.ForceAlive(humanoid)
        end
    end)
    
    table.insert(STATE.Connections, diedConn)
    
    -- ç¦ç”¨æ­»äº¡è„šæœ¬
    local function DisableScripts()
        Tools.Safe(function()
            local containers = {
                LocalPlayer.PlayerScripts,
                Workspace,
                ReplicatedStorage
            }
            
            for _, container in pairs(containers) do
                if container then
                    for _, child in pairs(container:GetDescendants()) do
                        if child:IsA("LocalScript") and Tools.Match(child.Name, CONFIG.DEATH_KEYWORDS) then
                            child.Disabled = true
                            STATE.BlockedScripts[child] = true
                        end
                    end
                end
            end
        end)
    end
    
    DisableScripts()
    
    -- ç›‘å¬æ–°è„šæœ¬
    local scriptConn = Workspace.DescendantAdded:Connect(function(desc)
        if desc:IsA("LocalScript") and Tools.Match(desc.Name, CONFIG.DEATH_KEYWORDS) then
            Tools.Safe(function()
                desc.Disabled = true
                STATE.BlockedScripts[desc] = true
            end)
        end
    end)
    
    table.insert(STATE.Connections, scriptConn)
end

-- ==================== æ¨¡å—5ï¼šè§’è‰²é˜²é”€æ¯ ====================
local DestroyModule = {}

function DestroyModule.Start(character)
    if not character then return end
    
    -- ç›‘å¬é”€æ¯
    local destroyConn = character.AncestryChanged:Connect(function(_, parent)
        if not parent and STATE.IsValid and not STATE.IsRespawning then
            STATE.IsRespawning = true
            
            -- è®°å½•ä½ç½®
            local root = Tools.GetChild(character, "HumanoidRootPart", "BasePart")
            if root then
                Tools.RecordPos(root.Position)
            end
            
            -- é‡ç”Ÿ
            Tools.Delay(CONFIG.RESPAWN_DELAY, function()
                Tools.Safe(function()
                    LocalPlayer:LoadCharacter()
                end)
                STATE.IsRespawning = false
            end)
        end
    end)
    
    table.insert(STATE.Connections, destroyConn)
    
    -- æ ¸å¿ƒéƒ¨ä»¶ä¿æŠ¤
    local criticalParts = {"Head", "HumanoidRootPart", "Torso", "UpperTorso", "LowerTorso"}
    
    local partConn = character.DescendantRemoving:Connect(function(desc)
        if not STATE.IsValid then return end
        
        for _, partName in pairs(criticalParts) do
            if desc.Name == partName and desc:IsA("BasePart") then
                Tools.Delay(0.01, function()
                    Tools.Safe(function()
                        local newPart = Instance.new("Part")
                        newPart.Name = desc.Name
                        newPart.Size = desc.Size
                        newPart.CFrame = desc.CFrame
                        newPart.Anchored = false
                        newPart.CanCollide = true
                        newPart.Parent = character
                        
                        if desc.Name == "HumanoidRootPart" then
                            local humanoid = Tools.GetChild(character, "Humanoid", "Humanoid")
                            if humanoid then
                                humanoid.RootPart = newPart
                            end
                        end
                    end)
                end)
                break
            end
        end
    end)
    
    table.insert(STATE.Connections, partConn)
end

-- ==================== æ¨¡å—6ï¼šè¿œç¨‹æŒ‡ä»¤æ‹¦æˆª ====================
local RemoteModule = {}

function RemoteModule.Start()
    -- æ‹¦æˆªå‡½æ•°
    local function BlockRemote(remote)
        if not remote or STATE.BlockedRemotes[remote] then return end
        
        if Tools.Match(remote.Name, CONFIG.DEATH_KEYWORDS) then
            STATE.BlockedRemotes[remote] = true
            
            Tools.Safe(function()
                if remote:IsA("RemoteEvent") then
                    -- èŽ·å–è¿žæŽ¥å¹¶æ–­å¼€
                    local connections = getconnections(remote.OnClientEvent)
                    for _, conn in pairs(connections) do
                        Tools.Disconnect(conn)
                    end
                    
                    -- è®¾ç½®å®‰å…¨å¤„ç†å™¨
                    remote.OnClientEvent = function(...)
                        local args = {...}
                        for _, arg in pairs(args) do
                            if arg == LocalPlayer then
                                if STATE.Humanoid then
                                    Tools.ForceAlive(STATE.Humanoid)
                                end
                                return
                            end
                        end
                    end
                end
                
                if remote:IsA("RemoteFunction") then
                    local original = remote.InvokeClient
                    if original then
                        remote.InvokeClient = function(...)
                            local args = {...}
                            for _, arg in pairs(args) do
                                if arg == LocalPlayer then
                                    if STATE.Humanoid then
                                        Tools.ForceAlive(STATE.Humanoid)
                                    end
                                    return nil
                                end
                            end
                            return original(...)
                        end
                    end
                end
            end)
        end
    end
    
    -- æ‰«æè¿œç¨‹å¯¹è±¡
    local function ScanRemotes()
        Tools.Safe(function()
            local containers = {
                ReplicatedStorage,
                Workspace,
                LocalPlayer.PlayerScripts
            }
            
            for _, container in pairs(containers) do
                if container then
                    for _, child in pairs(container:GetDescendants()) do
                        if child:IsA("RemoteEvent") or child:IsA("RemoteFunction") then
                            BlockRemote(child)
                        end
                    end
                end
            end
        end)
    end
    
    -- åˆå§‹æ‰«æ
    ScanRemotes()
    
    -- ç›‘å¬æ–°è¿œç¨‹å¯¹è±¡
    local remoteConn = ReplicatedStorage.DescendantAdded:Connect(function(desc)
        if desc:IsA("RemoteEvent") or desc:IsA("RemoteFunction") then
            Tools.Delay(0.1, function()
                BlockRemote(desc)
            end)
        end
    end)
    
    table.insert(STATE.Connections, remoteConn)
    
    -- å®šæœŸæ‰«æ
    local scanConn = RunService.Heartbeat:Connect(function()
        if tick() % 20 < 0.1 then
            ScanRemotes()
        end
    end)
    
    table.insert(STATE.Connections, scanConn)
end

-- ==================== æ¨¡å—7ï¼šæ— é™é‡ç”Ÿç³»ç»Ÿ ====================
local RespawnModule = {}

function RespawnModule.Start(character)
    if not character then return end
    
    local humanoid = Tools.GetChild(character, "Humanoid", "Humanoid")
    if not humanoid then return end
    
    -- è®°å½•åˆå§‹ä½ç½®
    local root = Tools.GetChild(character, "HumanoidRootPart", "BasePart")
    if root then
        Tools.RecordPos(root.Position)
    end
    
    -- æ­»äº¡äº‹ä»¶
    local diedConn = humanoid.Died:Connect(function()
        if STATE.IsRespawning then return end
        
        STATE.IsRespawning = true
        STATE.IsDead = true
        
        -- è®°å½•æ­»äº¡ä½ç½®
        local deathRoot = Tools.GetChild(character, "HumanoidRootPart", "BasePart")
        if deathRoot then
            Tools.RecordPos(deathRoot.Position)
        end
        
        -- ç ´è§£é‡ç”Ÿé™åˆ¶
        Tools.Safe(function()
            LocalPlayer:SetAttribute("CanRespawn", true)
            LocalPlayer:SetAttribute("RespawnLimit", math.huge)
            LocalPlayer:SetAttribute("OneLife", false)
            LocalPlayer:SetAttribute("NoRespawn", false)
        end)
        
        -- å»¶è¿Ÿé‡ç”Ÿ
        wait(CONFIG.RESPAWN_DELAY)
        
        -- å¼ºåˆ¶é‡ç”Ÿ
        for i = 1, 5 do
            local success = Tools.Safe(function()
                LocalPlayer:LoadCharacter()
                return true
            end)
            if success then break end
            wait(0.05)
        end
        
        STATE.IsRespawning = false
        STATE.IsDead = false
    end)
    
    table.insert(STATE.Connections, diedConn)
    
    -- é‡ç”Ÿä½ç½®è®¾ç½®
    local charConn = LocalPlayer.CharacterAdded:Connect(function(newChar)
        wait(0.5)
        
        if newChar and newChar:IsDescendantOf(Workspace) then
            local newRoot = Tools.GetChild(newChar, "HumanoidRootPart", "BasePart")
            if newRoot then
                Tools.Safe(function()
                    local respawnPos = Tools.GetRecentPos()
                    newRoot.CFrame = CFrame.new(respawnPos + CONFIG.RESPAWN_OFFSET)
                end)
            end
        end
    end)
    
    table.insert(STATE.Connections, charConn)
end

-- ==================== æ¨¡å—8ï¼šè§‚æˆ˜ç ´è§£ ====================
local SpectatorModule = {}

function SpectatorModule.Start()
    -- ç¦ç”¨è§‚æˆ˜UI
    local function DisableUI()
        Tools.Safe(function()
            local playerGui = LocalPlayer:FindFirstChild("PlayerGui")
            if playerGui then
                for _, gui in pairs(playerGui:GetChildren()) do
                    if gui:IsA("ScreenGui") then
                        if Tools.Match(gui.Name, CONFIG.SPECTATOR_KEYWORDS) then
                            gui.Enabled = false
                        end
                    end
                end
            end
        end)
    end
    
    -- ç¦ç”¨è§‚æˆ˜è„šæœ¬
    local function DisableScripts()
        Tools.Safe(function()
            local containers = {
                LocalPlayer.PlayerScripts,
                Workspace,
                ReplicatedStorage
            }
            
            for _, container in pairs(containers) do
                if container then
                    for _, script in pairs(container:GetDescendants()) do
                        if script:IsA("LocalScript") then
                            if Tools.Match(script.Name, CONFIG.SPECTATOR_KEYWORDS) then
                                script.Disabled = true
                            end
                        end
                    end
                end
            end
        end)
    end
    
    -- ç ´è§£è§‚æˆ˜çŠ¶æ€
    local function BypassSpectator()
        Tools.Safe(function()
            LocalPlayer:SetAttribute("Spectating", false)
            LocalPlayer:SetAttribute("InSpectatorMode", false)
            
            -- å¼ºåˆ¶ç›¸æœºæ¨¡å¼
            local camera = Workspace.CurrentCamera
            if camera then
                camera.CameraType = Enum.CameraType.Custom
                if LocalPlayer.Character then
                    local humanoid = Tools.GetChild(LocalPlayer.Character, "Humanoid", "Humanoid")
                    if humanoid then
                        camera.CameraSubject = humanoid
                    end
                end
            end
        end)
    end
    
    -- åˆå§‹æ‰§è¡Œ
    DisableUI()
    DisableScripts()
    BypassSpectator()
    
    -- å®šæœŸæ£€æŸ¥
    local checkConn = RunService.Heartbeat:Connect(function()
        BypassSpectator()
        if tick() % 10 < 0.1 then
            DisableUI()
        end
    end)
    
    table.insert(STATE.Connections, checkConn)
end

-- ==================== æ¨¡å—9ï¼šè§’è‰²å¼ºåŒ– ====================
local EnhanceModule = {}

function EnhanceModule.Start(character)
    if not character then return end
    
    local humanoid = Tools.GetChild(character, "Humanoid", "Humanoid")
    if not humanoid then return end
    
    Tools.Safe(function()
        -- ç”Ÿå‘½å€¼å¼ºåŒ–
        humanoid.MaxHealth = math.max(150, humanoid.MaxHealth * 2)
        humanoid.Health = humanoid.MaxHealth
        
        -- ç§»åŠ¨å¼ºåŒ–
        humanoid.WalkSpeed = math.min(40, humanoid.WalkSpeed * 1.4)
        humanoid.JumpPower = math.min(90, humanoid.JumpPower * 1.3)
        
        -- å…¶ä»–å¼ºåŒ–
        humanoid.AutoRotate = true
        humanoid.AutoJumpEnabled = true
    end)
end

-- ==================== ä¸»åˆå§‹åŒ–å‡½æ•° ====================
local function InitializeCharacter(character)
    if not character or not character:IsDescendantOf(Workspace) then
        return
    end
    
    -- ç­‰å¾…ç»„ä»¶åŠ è½½
    local humanoid, rootPart
    local start = tick()
    
    while tick() - start < 10 do
        humanoid = Tools.GetChild(character, "Humanoid", "Humanoid")
        rootPart = Tools.GetChild(character, "HumanoidRootPart", "BasePart")
        
        if humanoid and rootPart then
            break
        end
        wait(0.1)
    end
    
    if not humanoid or not rootPart then
        return
    end
    
    -- æ›´æ–°çŠ¶æ€
    STATE.Character = character
    STATE.Humanoid = humanoid
    STATE.RootPart = rootPart
    STATE.IsValid = true
    STATE.LastValidCF = rootPart.CFrame
    
    -- æ¸…ç†æ—§è¿žæŽ¥
    Tools.DisconnectAll()
    
    -- è§’è‰²å¼ºåŒ–
    EnhanceModule.Start(character)
    
    -- å¯åŠ¨æ‰€æœ‰æ¨¡å—
    HealModule.Start(humanoid)
    GrabModule.Start(character)
    WarpModule.Start(character)
    ScriptDeathModule.Start(humanoid)
    DestroyModule.Start(character)
    RemoteModule.Start()
    RespawnModule.Start(character)
    SpectatorModule.Start()
    
    -- è§’è‰²ç›‘æŽ§
    local monitorConn = RunService.Heartbeat:Connect(function()
        if not character or not character:IsDescendantOf(Workspace) then
            STATE.IsValid = false
            
            Tools.Delay(1, function()
                Tools.Safe(function()
                    LocalPlayer:LoadCharacter()
                end)
            end)
            return
        end
        
        -- æ£€æŸ¥ç”Ÿå‘½å€¼
        if humanoid and humanoid.Health <= 0 then
            Tools.ForceAlive(humanoid)
        end
        
        -- æ›´æ–°ä½ç½®
        if rootPart then
            STATE.LastValidCF = rootPart.CFrame
        end
    end)
    
    table.insert(STATE.Connections, monitorConn)
    
    print("[åˆå§‹åŒ–] è§’è‰²åˆå§‹åŒ–å®Œæˆ")
end

-- ==================== å…¨å±€åˆå§‹åŒ– ====================
local function GlobalInitialize()
    print("[å…¨å±€] å¼€å§‹åˆå§‹åŒ–è„šæœ¬...")
    
    -- ç­‰å¾…çŽ©å®¶
    while not LocalPlayer do
        wait(0.1)
        LocalPlayer = Players.LocalPlayer
    end
    
    -- ç»‘å®šè§’è‰²äº‹ä»¶
    local charConn = LocalPlayer.CharacterAdded:Connect(function(char)
        wait(0.5)
        InitializeCharacter(char)
    end)
    
    table.insert(STATE.Connections, charConn)
    
    -- å¤„ç†çŽ°æœ‰è§’è‰²
    if LocalPlayer.Character then
        wait(1)
        InitializeCharacter(LocalPlayer.Character)
    else
        wait(2)
        Tools.Safe(function()
            LocalPlayer:LoadCharacter()
        end)
    end
    
    -- é”™è¯¯å¤„ç†
    local errorConn = ScriptContext.Error:Connect(function(err)
        print("[é”™è¯¯]", err)
        
        wait(1)
        if STATE.Character and STATE.Character:IsDescendantOf(Workspace) then
            InitializeCharacter(STATE.Character)
        else
            Tools.Safe(function()
                LocalPlayer:LoadCharacter()
            end)
        end
    end)
    
    table.insert(STATE.Connections, errorConn)
    
    -- æ‰‹æœºä¼˜åŒ–
    if UserInputService.TouchEnabled then
        Tools.Safe(function()
            settings().Rendering.QualityLevel = 3
            Lighting.GlobalShadows = false
        end)
    end
    
    -- å®Œæˆæç¤º
    Tools.Delay(3, function()
        print("\n" .. string.rep("=", 60))
        print("ðŸ“± æ‰‹æœºç«¯ç”Ÿå­˜è„šæœ¬ - åŠ è½½æˆåŠŸ")
        print(string.rep("-", 60))
        print("âœ… æ ¸å¿ƒåŠŸèƒ½å·²æ¿€æ´»:")
        print("   â€¢ 9å€è‡ªåŠ¨å›žè¡€ç³»ç»Ÿ")
        print("   â€¢ åŽŸåœ°æ— é™é‡ç”Ÿ")
        print("   â€¢ æŠ“å–æ‹¦æˆª")
        print("   â€¢ çªè„¸æ‹¦æˆª")
        print("   â€¢ å‰§æƒ…æ€æ‹¦æˆª")
        print("   â€¢ è§’è‰²é˜²é”€æ¯")
        print("   â€¢ è¿œç¨‹æŒ‡ä»¤æ‹¦æˆª")
        print("   â€¢ è§‚æˆ˜ç ´è§£")
        print(string.rep("=", 60))
    end)
end

-- ==================== å¯åŠ¨è„šæœ¬ ====================
-- ä½¿ç”¨åç¨‹å¯åŠ¨
spawn(function()
    wait(2)
    GlobalInitialize()
end)

-- è¿”å›žæŽ¥å£
return {
    Status = function()
        return {
            Initialized = true,
            CharacterValid = STATE.IsValid,
            Health = STATE.Humanoid and STATE.Humanoid.Health or 0
        }
    end,
    
    ForceRespawn = function()
        if STATE.Character then
            local root = Tools.GetChild(STATE.Character, "HumanoidRootPart", "BasePart")
            if root then
                Tools.RecordPos(root.Position)
            end
        end
        Tools.Safe(function()
            LocalPlayer:LoadCharacter()
        end)
    end
}
]])()