loadstring([[
-- ==============================================
-- Roblox全游戏防死亡终极脚本（彻底拦截死亡）
-- 核心：三重死亡拦截+强制状态锁定，杜绝死亡判定
-- 适配：Forsaken/Doors/所有含死亡机制的Roblox游戏
-- ==============================================
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")

-- 全局状态（极简锁定，防空值）
local GlobalState = {
    Char = nil,
    Hum = nil,
    HRP = nil,
    -- 强制锁定满状态
    ForceFullHealth = true,
    DisableDeath = true
}

-- ===================== 强制初始化角色（防加载失败） =====================
local function ForceInitChar()
    -- 强制等待角色生成（无视服务器延迟）
    GlobalState.Char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    task.wait(1.5) -- 基础延迟，适配所有游戏
    
    -- 强制获取核心组件（超时直接重试）
    GlobalState.Hum = GlobalState.Char:WaitForChild("Humanoid", 10) or ForceInitChar()
    GlobalState.HRP = GlobalState.Char:WaitForChild("HumanoidRootPart", 10) or ForceInitChar()
    
    print("[ForceInit] 角色组件锁定完成")
    
    -- 1. 第一层拦截：禁用死亡状态（底层）
    GlobalState.Hum.BreakJointsOnDeath = false
    GlobalState.Hum:SetStateEnabled(Enum.HumanoidStateType.Dead, false)
    GlobalState.Hum:SetStateEnabled(Enum.HumanoidStateType.Ragdoll, false)
    
    -- 2. 第二层拦截：覆盖Died事件（优先级最高）
    GlobalState.Hum.Died:Connect(function()
        print("[DeathIntercept] 强制拦截死亡事件")
        -- 瞬间恢复满血量
        GlobalState.Hum.Health = GlobalState.Hum.MaxHealth
        -- 强制解除所有控制状态
        GlobalState.Hum:ChangeState(Enum.HumanoidStateType.Running)
    end)
    
    -- 3. 第三层拦截：血量变化实时拦截
    GlobalState.Hum.HealthChanged:Connect(function(health)
        if health < GlobalState.Hum.MaxHealth then
            GlobalState.Hum.Health = GlobalState.Hum.MaxHealth
            print("[HealthLock] 强制维持满血量")
        end
    end)
end

-- ===================== 实时状态锁定（杜绝死亡漏判） =====================
RunService.RenderStepped:Connect(function() -- 用RenderStepped提升拦截优先级
    -- 组件失效立即重试
    if not GlobalState.Char or not GlobalState.Hum or not GlobalState.HRP then
        ForceInitChar()
        return
    end
    
    -- 强制锁定核心状态（每帧执行，防服务器覆盖）
    GlobalState.Hum.BreakJointsOnDeath = false
    GlobalState.Hum:SetStateEnabled(Enum.HumanoidStateType.Dead, false)
    GlobalState.Hum.Health = GlobalState.Hum.MaxHealth
    
    -- 强制解除异常状态（覆盖所有控制）
    if GlobalState.Hum:GetState() ~= Enum.HumanoidStateType.Running then
        GlobalState.Hum:ChangeState(Enum.HumanoidStateType.Running)
    end
    
    -- 停止所有异常动画（防处决动画锁定）
    for _, track in ipairs(GlobalState.Hum:GetPlayingAnimationTracks()) do
        if track.Name:lower():find("death") or track.Name:lower():find("exec") or track.Speed > 2 then
            track:Stop()
        end
    end
end)

-- ===================== 重生后强制重锁（防状态丢失） =====================
LocalPlayer.CharacterAdded:Connect(function()
    print("[RespawnLock] 角色重生，强制重锁状态")
    GlobalState.Char = nil
    GlobalState.Hum = nil
    GlobalState.HRP = nil
    task.wait(1.8) -- 适配重生后服务器同步
    ForceInitChar()
end)

-- 首次强制初始化
ForceInitChar()
print("✅ 终极防死亡脚本启动 | 零死亡+零报错")
]])()
